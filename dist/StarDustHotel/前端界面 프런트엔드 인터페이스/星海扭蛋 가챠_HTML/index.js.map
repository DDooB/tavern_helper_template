{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src/StarDustHotel/å‰ç«¯ç•Œé¢ í”„ëŸ°íŠ¸ì—”ë“œ ì¸í„°í˜ì´ìŠ¤/æ˜Ÿæµ·æ‰­è›‹ ê°€ì± _HTML/index.ts"],"sourcesContent":["import './style.css';\n\ntype DrawType = 'normal' | 'advanced';\ntype GachaTab = 'normal' | 'advanced' | 'pickup' | 'custom';\n\ntype DrawResult = {\n  ok: boolean;\n  code: string;\n  message: string;\n  spent: number;\n  refund: number;\n  partnerId?: string;\n  partnerName?: string;\n  isDuplicate?: boolean;\n};\n\ntype PoolPartner = {\n  Id: string;\n  Name: string;\n  Grade: string;\n  Class: string;\n  Job: string;\n};\n\ntype OwnedPartner = {\n  Id: string;\n  Name: string;\n  Grade: string;\n  Class: string;\n  Job: string;\n  InParty: boolean;\n  Alive: boolean;\n  Level: number;\n};\n\ntype Snapshot = {\n  sdp: number;\n  ownedCount: number;\n  poolCount: number;\n  csvUrl: string;\n  lastPoolSyncAt: number;\n  stat?: {\n    User?: {\n      SDP?: number;\n    };\n  };\n  pool: PoolPartner[];\n  ownedPartners: OwnedPartner[];\n};\n\ntype SdhApi = {\n  getSnapshot: () => Promise<Snapshot>;\n  setPoolCsvUrl: (url: string) => Promise<void>;\n  refreshPoolFromCsv: () => Promise<{ ok: boolean; message: string; count: number }>;\n  drawGacha: (drawType: DrawType) => Promise<DrawResult>;\n  pickupByName: (name: string) => Promise<DrawResult>;\n  registerCustomPartner: (input: {\n    Id: string;\n    Name: string;\n    Grade: string;\n    Class: string;\n    Job: string;\n    Level?: number;\n    Affinity?: number;\n    LoveLevel?: number;\n  }) => Promise<DrawResult>;\n};\n\ntype ResultPartner = {\n  Name: string;\n  Level: number;\n  Grade: string;\n  Class: string;\n  Job: string;\n};\n\nconst state: {\n  busy: boolean;\n  snapshot: Snapshot | null;\n  api: SdhApi | null;\n  activeTab: GachaTab;\n  resultMessage: string;\n  lastResultPartner: ResultPartner | null;\n} = {\n  busy: false,\n  snapshot: null,\n  api: null,\n  activeTab: 'normal',\n  resultMessage: 'ëŒ€ê¸°ì¤‘',\n  lastResultPartner: null,\n};\n\nfunction esc(input: string): string {\n  return input\n    .replaceAll('&', '&amp;')\n    .replaceAll('<', '&lt;')\n    .replaceAll('>', '&gt;')\n    .replaceAll('\"', '&quot;')\n    .replaceAll(\"'\", '&#39;');\n}\n\nfunction classEmoji(raw: string): string {\n  const value = raw.trim().toLowerCase();\n  if (value === 'tank') return 'ğŸ›¡ï¸';\n  if (value === 'dps') return 'âš”ï¸';\n  if (value === 'heal' || value === 'healer') return 'âœ¨';\n  if (value === 'support') return 'ğŸŒ¿';\n  return 'ğŸ’';\n}\n\nfunction renderLayout(): void {\n  $('#app').html(`\n    <main class=\"page\">\n      <section class=\"gacha-shell\">\n        <header class=\"header\">\n          <h1 class=\"title\">STAR SEA GACHA</h1>\n          <p class=\"sub\">í™•ë¥  ê¸°ë°˜ ì†Œí™˜ / íŒŒíŠ¸ë„ˆ ë“±ë¡</p>\n          <div class=\"status-row\">\n            <span id=\"stat-sdp\" class=\"pill\">SDP 0</span>\n            <span id=\"stat-owned\" class=\"pill\">ë³´ìœ  0</span>\n            <span id=\"stat-pool\" class=\"pill\">í’€ 0</span>\n          </div>\n        </header>\n\n        <section class=\"csv-bar\">\n          <input id=\"csv-url\" class=\"input grow\" placeholder=\"Google Spreadsheet CSV URL\" />\n          <button id=\"btn-save-url\" class=\"btn\">URL ì €ì¥</button>\n          <button id=\"btn-reload-pool\" class=\"btn alt\">í’€ ë™ê¸°í™”</button>\n          <button id=\"btn-refresh\" class=\"btn dark\">ê°±ì‹ </button>\n        </section>\n        <p id=\"hint-csv\" class=\"hint\">í˜„ì¬ URL: (ë¯¸ì„¤ì •)</p>\n\n        <nav class=\"tab-nav\" role=\"tablist\" aria-label=\"ê°€ì±  ë°©ì‹\">\n          <button class=\"tab-btn is-active\" data-tab=\"normal\" type=\"button\">ì¼ë°˜ ê°€ì± </button>\n          <button class=\"tab-btn\" data-tab=\"advanced\" type=\"button\">ê³ ê¸‰ ê°€ì± </button>\n          <button class=\"tab-btn\" data-tab=\"pickup\" type=\"button\">í”½ì—… ê°€ì± </button>\n          <button class=\"tab-btn\" data-tab=\"custom\" type=\"button\">ì»¤ìŠ¤í…€ ë“±ë¡</button>\n        </nav>\n\n        <section class=\"tab-panel is-active\" data-panel=\"normal\">\n          <h2 class=\"panel-title\">ì¼ë°˜ ê°€ì± </h2>\n          <p class=\"rate\">ë¹„ìš© 1,000 SDP | EX 0.1% / S 1% / A 5% / B 15% / C 30% / D 48.9%</p>\n          <button id=\"btn-draw-normal\" class=\"btn\">ì¼ë°˜ 1íšŒ ì†Œí™˜</button>\n        </section>\n\n        <section class=\"tab-panel\" data-panel=\"advanced\">\n          <h2 class=\"panel-title\">ê³ ê¸‰ ê°€ì± </h2>\n          <p class=\"rate\">ë¹„ìš© 5,000 SDP | EX 2% / S 8% / A 20% / B 30% / C 40% / D 0%</p>\n          <button id=\"btn-draw-advanced\" class=\"btn\">ê³ ê¸‰ 1íšŒ ì†Œí™˜</button>\n        </section>\n\n        <section class=\"tab-panel\" data-panel=\"pickup\">\n          <h2 class=\"panel-title\">í”½ì—… ê°€ì± </h2>\n          <p class=\"rate\">ë¹„ìš© 50,000 SDP | í’€ì— ìˆëŠ” ì´ë¦„ë§Œ ì§€ì • ê°€ëŠ¥</p>\n          <input id=\"pickup-name\" class=\"input\" list=\"pickup-suggestions\" placeholder=\"íŒŒíŠ¸ë„ˆ ì´ë¦„ ì…ë ¥\" />\n          <datalist id=\"pickup-suggestions\"></datalist>\n          <div style=\"height:8px\"></div>\n          <button id=\"btn-pickup\" class=\"btn\">í”½ì—… ì†Œí™˜</button>\n        </section>\n\n        <section class=\"tab-panel\" data-panel=\"custom\">\n          <h2 class=\"panel-title\">ì»¤ìŠ¤í…€ íŒŒíŠ¸ë„ˆ ë“±ë¡</h2>\n          <p class=\"rate\">ë¹„ìš© 10,000 SDP | Grade: EX,S,A,B,C,D | Class: tank,dps,heal,support,allRound</p>\n          <div class=\"form-grid\">\n            <input id=\"custom-name\" class=\"input\" placeholder=\"ì´ë¦„\" />\n            <input id=\"custom-id\" class=\"input\" placeholder=\"ID (ë¹„ìš°ë©´ ì´ë¦„ ì‚¬ìš©)\" />\n            <select id=\"custom-grade\" class=\"select\">\n              <option value=\"D\">D</option>\n              <option value=\"C\">C</option>\n              <option value=\"B\">B</option>\n              <option value=\"A\">A</option>\n              <option value=\"S\">S</option>\n              <option value=\"EX\">EX</option>\n            </select>\n            <select id=\"custom-class\" class=\"select\">\n              <option value=\"tank\">tank</option>\n              <option value=\"dps\">dps</option>\n              <option value=\"heal\">heal</option>\n              <option value=\"support\" selected>support</option>\n              <option value=\"allRound\">allRound</option>\n            </select>\n            <input id=\"custom-job\" class=\"input\" placeholder=\"ì§ì—…\" />\n            <input id=\"custom-level\" class=\"input\" type=\"number\" min=\"1\" value=\"1\" placeholder=\"ë ˆë²¨\" />\n            <input id=\"custom-affinity\" class=\"input\" type=\"number\" value=\"0\" placeholder=\"í˜¸ê°ë„\" />\n            <input id=\"custom-lovelevel\" class=\"input\" type=\"number\" value=\"0\" placeholder=\"ëŸ¬ë¸Œ ë ˆë²¨\" />\n          </div>\n          <button id=\"btn-custom-register\" class=\"btn\">ì»¤ìŠ¤í…€ ë“±ë¡</button>\n        </section>\n\n        <section class=\"result-box\">\n          <p id=\"result-message\" class=\"result-message\">ëŒ€ê¸°ì¤‘</p>\n          <div id=\"result-card\" class=\"result-card\">\n            <div id=\"result-name\" class=\"result-name\">-</div>\n            <div id=\"result-meta\" class=\"result-meta\">-</div>\n          </div>\n        </section>\n      </section>\n    </main>\n  `);\n}\n\nfunction activateTab(tab: GachaTab): void {\n  state.activeTab = tab;\n  $('.tab-btn').removeClass('is-active');\n  $(`.tab-btn[data-tab=\"${tab}\"]`).addClass('is-active');\n  $('.tab-panel').removeClass('is-active');\n  $(`.tab-panel[data-panel=\"${tab}\"]`).addClass('is-active');\n}\n\nfunction applyBusyState(): void {\n  $('button').prop('disabled', state.busy);\n  $('input').prop('disabled', state.busy);\n  $('select').prop('disabled', state.busy);\n}\n\nfunction renderResult(): void {\n  $('#result-message').text(state.resultMessage);\n  if (!state.lastResultPartner) {\n    $('#result-card').removeClass('active');\n    return;\n  }\n\n  const p = state.lastResultPartner;\n  $('#result-name').text(`${p.Name} (${p.Grade})`);\n  $('#result-meta').text(`Lv.${p.Level} | ${classEmoji(p.Class)} ${p.Class} | ${p.Job}`);\n  $('#result-card').addClass('active');\n}\n\nfunction renderSnapshot(snapshot: Snapshot | null): void {\n  if (!snapshot) return;\n  const sdp = snapshot.stat?.User?.SDP ?? snapshot.sdp;\n  $('#stat-sdp').text(`SDP ${sdp.toLocaleString()}`);\n  $('#stat-owned').text(`ë³´ìœ  ${snapshot.ownedCount}`);\n  $('#stat-pool').text(`í’€ ${snapshot.poolCount}`);\n  $('#hint-csv').text(`í˜„ì¬ URL: ${snapshot.csvUrl || '(ë¯¸ì„¤ì •)'} | ë™ê¸°í™”: ${snapshot.lastPoolSyncAt ? new Date(snapshot.lastPoolSyncAt).toLocaleString() : '(ì—†ìŒ)'}`);\n  $('#csv-url').val(snapshot.csvUrl);\n\n  const names = snapshot.pool\n    .map(item => item.Name.trim())\n    .filter(name => name !== '')\n    .filter((name, idx, arr) => arr.indexOf(name) === idx)\n    .slice(0, 400)\n    .map(name => `<option value=\"${esc(name)}\"></option>`)\n    .join('');\n\n  $('#pickup-suggestions').html(names);\n}\n\nasync function resolveApi(): Promise<SdhApi | null> {\n  for (let i = 0; i < 30; i += 1) {\n    const api = (window.top as Window & { SDH?: SdhApi }).SDH ?? (window as Window & { SDH?: SdhApi }).SDH;\n    if (api) return api;\n    await new Promise(resolve => setTimeout(resolve, 200));\n  }\n  return null;\n}\n\nasync function refreshSnapshot(): Promise<void> {\n  if (!state.api) return;\n  state.snapshot = await state.api.getSnapshot();\n  renderSnapshot(state.snapshot);\n}\n\nfunction buildResultPartner(result: DrawResult): ResultPartner | null {\n  if (!state.snapshot || !result.partnerName) return null;\n\n  const byId = result.partnerId\n    ? state.snapshot.ownedPartners.find(p => p.Id === result.partnerId)\n    : undefined;\n  const byName = state.snapshot.ownedPartners.find(p => p.Name === result.partnerName);\n  const fromOwned = byId ?? byName;\n  if (fromOwned) {\n    return {\n      Name: fromOwned.Name,\n      Level: fromOwned.Level,\n      Grade: fromOwned.Grade,\n      Class: fromOwned.Class,\n      Job: fromOwned.Job,\n    };\n  }\n\n  const byPool = state.snapshot.pool.find(p => p.Id === result.partnerId || p.Name === result.partnerName);\n  if (byPool) {\n    return {\n      Name: byPool.Name,\n      Level: 1,\n      Grade: byPool.Grade,\n      Class: byPool.Class,\n      Job: byPool.Job,\n    };\n  }\n\n  return null;\n}\n\nfunction resultText(result: DrawResult): string {\n  const costText = `ì†Œëª¨ ${result.spent} SDP`;\n  const refundText = result.refund > 0 ? ` / í™˜ê¸‰ ${result.refund} SDP` : '';\n  return `${result.message} (${costText}${refundText})`;\n}\n\nasync function runAction(task: () => Promise<void>): Promise<void> {\n  if (state.busy) return;\n  state.busy = true;\n  applyBusyState();\n  try {\n    await task();\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    state.resultMessage = `ì˜¤ë¥˜: ${message}`;\n    state.lastResultPartner = null;\n    renderResult();\n    toastr.error(state.resultMessage);\n  } finally {\n    state.busy = false;\n    applyBusyState();\n  }\n}\n\nfunction bindEvents(): void {\n  $('.tab-btn').on('click', function onTabClick() {\n    const tab = String($(this).data('tab')) as GachaTab;\n    activateTab(tab);\n  });\n\n  $('#btn-save-url').on('click', () => {\n    void runAction(async () => {\n      if (!state.api) return;\n      await state.api.setPoolCsvUrl(String($('#csv-url').val() ?? '').trim());\n      await refreshSnapshot();\n      state.resultMessage = 'CSV URL ì €ì¥ ì™„ë£Œ';\n      state.lastResultPartner = null;\n      renderResult();\n      toastr.success(state.resultMessage);\n    });\n  });\n\n  $('#btn-reload-pool').on('click', () => {\n    void runAction(async () => {\n      if (!state.api) return;\n      const result = await state.api.refreshPoolFromCsv();\n      await refreshSnapshot();\n      state.resultMessage = result.message;\n      state.lastResultPartner = null;\n      renderResult();\n      if (result.ok) toastr.success(state.resultMessage);\n      else toastr.warning(state.resultMessage);\n    });\n  });\n\n  $('#btn-refresh').on('click', () => {\n    void runAction(async () => {\n      await refreshSnapshot();\n      state.resultMessage = 'ìƒíƒœ ê°±ì‹  ì™„ë£Œ';\n      state.lastResultPartner = null;\n      renderResult();\n      toastr.info(state.resultMessage);\n    });\n  });\n\n  $('#btn-draw-normal').on('click', () => {\n    void runAction(async () => {\n      if (!state.api) return;\n      const result = await state.api.drawGacha('normal');\n      await refreshSnapshot();\n      state.resultMessage = resultText(result);\n      state.lastResultPartner = buildResultPartner(result);\n      renderResult();\n      if (result.ok) toastr.success(state.resultMessage);\n      else toastr.warning(state.resultMessage);\n    });\n  });\n\n  $('#btn-draw-advanced').on('click', () => {\n    void runAction(async () => {\n      if (!state.api) return;\n      const result = await state.api.drawGacha('advanced');\n      await refreshSnapshot();\n      state.resultMessage = resultText(result);\n      state.lastResultPartner = buildResultPartner(result);\n      renderResult();\n      if (result.ok) toastr.success(state.resultMessage);\n      else toastr.warning(state.resultMessage);\n    });\n  });\n\n  $('#btn-pickup').on('click', () => {\n    void runAction(async () => {\n      if (!state.api) return;\n      const result = await state.api.pickupByName(String($('#pickup-name').val() ?? '').trim());\n      await refreshSnapshot();\n      state.resultMessage = resultText(result);\n      state.lastResultPartner = buildResultPartner(result);\n      renderResult();\n      if (result.ok) toastr.success(state.resultMessage);\n      else toastr.warning(state.resultMessage);\n    });\n  });\n\n  $('#btn-custom-register').on('click', () => {\n    void runAction(async () => {\n      if (!state.api) return;\n      const payload = {\n        Id: String($('#custom-id').val() ?? '').trim() || String($('#custom-name').val() ?? '').trim(),\n        Name: String($('#custom-name').val() ?? '').trim(),\n        Grade: String($('#custom-grade').val() ?? 'D').trim(),\n        Class: String($('#custom-class').val() ?? 'support').trim(),\n        Job: String($('#custom-job').val() ?? '').trim() || 'ë¯¸ì •',\n        Level: Number($('#custom-level').val() ?? 1),\n        Affinity: Number($('#custom-affinity').val() ?? 0),\n        LoveLevel: Number($('#custom-lovelevel').val() ?? 0),\n      };\n\n      const result = await state.api.registerCustomPartner(payload);\n      await refreshSnapshot();\n      state.resultMessage = resultText(result);\n      state.lastResultPartner = buildResultPartner(result);\n      renderResult();\n      if (result.ok) toastr.success(state.resultMessage);\n      else toastr.warning(state.resultMessage);\n    });\n  });\n}\n\n$(async () => {\n  renderLayout();\n  bindEvents();\n  activateTab('normal');\n  renderResult();\n\n  state.resultMessage = 'SDH API ì—°ê²° ì¤‘...';\n  renderResult();\n\n  state.api = await resolveApi();\n  if (!state.api) {\n    state.resultMessage = 'SDH íŒŒíŠ¸ë„ˆ ì‹œìŠ¤í…œ APIë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';\n    renderResult();\n    toastr.error(state.resultMessage);\n    return;\n  }\n\n  await refreshSnapshot();\n  state.resultMessage = 'ì¤€ë¹„ ì™„ë£Œ';\n  renderResult();\n});\n"],"names":["state","busy","snapshot","api","activeTab","resultMessage","lastResultPartner","activateTab","tab","$","removeClass","addClass","applyBusyState","prop","renderResult","text","p","Name","Grade","Level","raw","value","trim","toLowerCase","classEmoji","Class","Job","async","refreshSnapshot","getSnapshot","sdp","stat","User","SDP","toLocaleString","ownedCount","poolCount","csvUrl","lastPoolSyncAt","Date","val","names","pool","map","item","filter","name","idx","arr","indexOf","slice","input","replaceAll","join","html","renderSnapshot","buildResultPartner","result","partnerName","byId","partnerId","ownedPartners","find","Id","undefined","byName","fromOwned","byPool","resultText","costText","spent","refundText","refund","message","runAction","task","error","Error","String","toastr","on","this","data","setPoolCsvUrl","success","refreshPoolFromCsv","ok","warning","info","drawGacha","pickupByName","payload","Number","Affinity","LoveLevel","registerCustomPartner","i","window","top","SDH","Promise","resolve","setTimeout","resolveApi"],"sourceRoot":""}