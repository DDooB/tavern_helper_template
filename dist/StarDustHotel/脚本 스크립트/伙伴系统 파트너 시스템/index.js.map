{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/StarDustHotel/schema.ts","src://tavern_helper_template/src/StarDustHotel/脚本 스크립트/伙伴系统 파트너 시스템/index.ts","src://tavern_helper_template/external var \"Vue\""],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","const PARTNER_GRADES = ['EX', 'S', 'A', 'B', 'C', 'D'];\nconst PARTNER_CLASSES = ['tank', 'dps', 'heal', 'support', 'allRound'];\nfunction normalizePartnerGrade(raw) {\n    const value = raw.trim().toUpperCase();\n    return PARTNER_GRADES.includes(value)\n        ? value\n        : 'D';\n}\nfunction normalizePartnerClass(raw) {\n    const lowered = raw.trim().toLowerCase();\n    if (lowered === 'tank')\n        return 'tank';\n    if (lowered === 'dps')\n        return 'dps';\n    if (lowered === 'heal' || lowered === 'healer')\n        return 'heal';\n    if (lowered === 'support')\n        return 'support';\n    if (lowered === 'allround' ||\n        lowered === 'all_round' ||\n        lowered === 'all-round' ||\n        lowered === 'allrounder' ||\n        lowered === 'all-rounder') {\n        return 'allRound';\n    }\n    return 'support';\n}\nexport const Schema = z\n    .object({\n    User: z.object({\n        Level: z.coerce.number().transform(v => Math.max(1, Math.trunc(v))),\n        Costume: z.string(),\n        SDP: z.coerce.number().transform(v => Math.max(0, Math.trunc(v))),\n        Inventory: z.record(z.string().describe('Item ID'), z.object({\n            Description: z.string(),\n            Quantity: z.coerce.number().transform(v => Math.max(0, Math.trunc(v))),\n        })),\n        PartySlots: z.record(z.enum(['Slot1', 'Slot2', 'Slot3']), z.string()),\n        PartySlotData: z.record(z.enum(['Slot1', 'Slot2', 'Slot3']), z.union([\n            z.literal(''),\n            z.object({\n                PartnerId: z.string(),\n                Name: z.string(),\n                Level: z.coerce.number().transform(v => Math.max(1, Math.trunc(v))),\n                Grade: z.string().transform(v => normalizePartnerGrade(v)),\n                Class: z.string().transform(v => normalizePartnerClass(v)),\n                Job: z.string(),\n                Affinity: z.coerce.number().transform(v => Math.trunc(v)),\n                LoveLevel: z.coerce.number().transform(v => _.clamp(Math.trunc(v), -5, 5)),\n                Fatigue: z.coerce.number().transform(v => _.clamp(Math.trunc(v), 0, 100)),\n                Alive: z.boolean(),\n            }),\n        ])),\n        _OwnedPartnerCount: z.coerce.number().transform(v => Math.max(0, Math.trunc(v))),\n    }),\n    Mission: z.object({\n        OnMission: z.boolean(),\n        MissionType: z.enum(['normal', 'eros']),\n        MissionGrade: z.enum(['S', 'A', 'B', 'C', 'D']),\n        WorldName: z.string(),\n        WorldSummaryAndObjective: z.string(),\n    }),\n})\n    .transform(data => {\n    const slots = ['Slot1', 'Slot2', 'Slot3'];\n    const dedupedIds = [];\n    for (const slot of slots) {\n        const rawId = data.User.PartySlots[slot].trim();\n        if (rawId === '' || dedupedIds.includes(rawId))\n            continue;\n        dedupedIds.push(rawId);\n    }\n    slots.forEach((slot, index) => {\n        const partnerId = dedupedIds[index] ?? '';\n        data.User.PartySlots[slot] = partnerId;\n        const slotData = data.User.PartySlotData[slot];\n        if (partnerId === '' || slotData === '') {\n            data.User.PartySlotData[slot] = '';\n            return;\n        }\n        let affinity = Math.trunc(slotData.Affinity);\n        let loveLevel = _.clamp(Math.trunc(slotData.LoveLevel), -5, 5);\n        while (affinity >= 100 && loveLevel < 5) {\n            affinity -= 100;\n            loveLevel += 1;\n        }\n        while (affinity <= -100 && loveLevel > -5) {\n            affinity += 100;\n            loveLevel -= 1;\n        }\n        data.User.PartySlotData[slot] = {\n            ...slotData,\n            PartnerId: partnerId,\n            Level: Math.max(1, Math.trunc(slotData.Level)),\n            Grade: normalizePartnerGrade(slotData.Grade),\n            Class: normalizePartnerClass(slotData.Class),\n            Affinity: _.clamp(affinity, -99, 99),\n            LoveLevel: _.clamp(loveLevel, -5, 5),\n            Fatigue: _.clamp(Math.trunc(slotData.Fatigue), 0, 100),\n        };\n    });\n    data.User._OwnedPartnerCount = Math.max(0, Math.trunc(data.User._OwnedPartnerCount));\n    // Mission fallback values.\n    if (!data.Mission.OnMission) {\n        data.Mission.MissionType = 'normal';\n        data.Mission.MissionGrade = 'D';\n        data.Mission.WorldName = '스타더스트 호텔';\n        data.Mission.WorldSummaryAndObjective = '대기중';\n    }\n    else {\n        if (data.Mission.WorldName.trim() === '')\n            data.Mission.WorldName = '스타더스트 호텔';\n        if (data.Mission.WorldSummaryAndObjective.trim() === '')\n            data.Mission.WorldSummaryAndObjective = '임무 진행중';\n    }\n    return data;\n});\n","import { Schema as MvuSchema } from '../../schema';\nconst CHAT_STORE_PATH = 'sdh';\nconst SLOTS = ['Slot1', 'Slot2', 'Slot3'];\nconst COST_NORMAL = 1000;\nconst COST_ADVANCED = 5000;\nconst COST_PICKUP = 50000;\nconst COST_CUSTOM = 10000;\nconst RATE_NORMAL = [\n    { grade: 'EX', weight: 0.1 },\n    { grade: 'S', weight: 1 },\n    { grade: 'A', weight: 5 },\n    { grade: 'B', weight: 15 },\n    { grade: 'C', weight: 30 },\n    { grade: 'D', weight: 48.9 },\n];\nconst RATE_ADVANCED = [\n    { grade: 'EX', weight: 2 },\n    { grade: 'S', weight: 8 },\n    { grade: 'A', weight: 20 },\n    { grade: 'B', weight: 30 },\n    { grade: 'C', weight: 40 },\n    { grade: 'D', weight: 0 },\n];\nconst PARTNER_GRADES = ['EX', 'S', 'A', 'B', 'C', 'D'];\nfunction tryNormalizeGrade(raw) {\n    const value = raw.trim().toUpperCase();\n    return PARTNER_GRADES.includes(value) ? value : null;\n}\nfunction normalizeGrade(raw, fallback = 'D') {\n    return tryNormalizeGrade(raw) ?? fallback;\n}\nfunction tryNormalizeClass(raw) {\n    const value = raw.trim().toLowerCase();\n    if (value === 'tank')\n        return 'tank';\n    if (value === 'dps')\n        return 'dps';\n    if (value === 'heal' || value === 'healer')\n        return 'heal';\n    if (value === 'support')\n        return 'support';\n    if (value === 'allround' ||\n        value === 'all_round' ||\n        value === 'all-round' ||\n        value === 'allrounder' ||\n        value === 'all-rounder') {\n        return 'allRound';\n    }\n    return null;\n}\nfunction normalizeClass(raw, fallback = 'support') {\n    return tryNormalizeClass(raw) ?? fallback;\n}\nfunction normalizePartnerId(raw) {\n    return raw.trim().toLowerCase().replace(/\\s+/g, '_').replace(/[^a-z0-9_]/g, '');\n}\nfunction normalizeName(raw) {\n    return raw.trim().toLowerCase();\n}\nfunction defaultBriefKey(id) {\n    return `{{SDH_BRIEF_${id.toUpperCase()}}}`;\n}\nfunction defaultDetailKey(id) {\n    return `{{SDH_DETAIL_${id.toUpperCase()}}}`;\n}\nfunction now() {\n    return Date.now();\n}\nfunction toSafeInt(value, fallback) {\n    const num = Number(value);\n    return Number.isFinite(num) ? Math.trunc(num) : fallback;\n}\nfunction clampState(state) {\n    const next = { ...state };\n    next.Level = Math.max(1, toSafeInt(next.Level, 1));\n    next.Fatigue = _.clamp(toSafeInt(next.Fatigue, 0), 0, 100);\n    next.LoveLevel = _.clamp(toSafeInt(next.LoveLevel, 0), -5, 5);\n    next.Affinity = toSafeInt(next.Affinity, 0);\n    while (next.Affinity >= 100 && next.LoveLevel < 5) {\n        next.Affinity -= 100;\n        next.LoveLevel += 1;\n    }\n    while (next.Affinity <= -100 && next.LoveLevel > -5) {\n        next.Affinity += 100;\n        next.LoveLevel -= 1;\n    }\n    next.Affinity = _.clamp(next.Affinity, -99, 99);\n    if (!next.Alive)\n        next.InParty = false;\n    return next;\n}\nfunction makePartnerRecord(input) {\n    const id = normalizePartnerId(input.Id);\n    return {\n        Id: id,\n        Meta: {\n            Name: input.Name.trim(),\n            Grade: normalizeGrade(input.Grade),\n            Class: normalizeClass(input.Class),\n            Job: input.Job.trim() || '미정',\n        },\n        State: clampState({\n            Level: input.Level ?? 1,\n            Affinity: input.Affinity ?? 0,\n            LoveLevel: input.LoveLevel ?? 0,\n            Fatigue: 0,\n            Alive: true,\n            InParty: false,\n        }),\n        ProfileKeys: {\n            BriefKey: (input.BriefKey ?? defaultBriefKey(id)).trim(),\n            DetailKey: (input.DetailKey ?? defaultDetailKey(id)).trim(),\n        },\n        UpdatedAt: now(),\n    };\n}\nfunction makePoolPartner(input) {\n    const id = normalizePartnerId(input.id || input.name);\n    return {\n        Id: id,\n        Name: input.name.trim() || id,\n        Grade: normalizeGrade(input.grade ?? 'D'),\n        Class: normalizeClass(input.clazz ?? 'support'),\n        Job: (input.job ?? '미정').trim() || '미정',\n        BriefKey: (input.briefKey ?? defaultBriefKey(id)).trim(),\n        DetailKey: (input.detailKey ?? defaultDetailKey(id)).trim(),\n    };\n}\nfunction defaultStore() {\n    const luna = makePartnerRecord({\n        Id: 'luna',\n        Name: 'Luna',\n        Grade: 'B',\n        Class: 'support',\n        Job: '정보 중개인',\n        Level: 1,\n        Affinity: 15,\n        LoveLevel: 0,\n    });\n    luna.State.InParty = true;\n    luna.State.Fatigue = 20;\n    const rhea = makePartnerRecord({\n        Id: 'rhea',\n        Name: 'Rhea',\n        Grade: 'C',\n        Class: 'heal',\n        Job: '전투 의무관',\n        Level: 1,\n        Affinity: -5,\n        LoveLevel: 0,\n    });\n    rhea.State.Fatigue = 10;\n    const pool = {\n        luna: makePoolPartner({ id: 'luna', name: 'Luna', grade: 'B', clazz: 'support', job: '정보 중개인' }),\n        rhea: makePoolPartner({ id: 'rhea', name: 'Rhea', grade: 'C', clazz: 'heal', job: '전투 의무관' }),\n    };\n    return {\n        partnerDb: { luna, rhea },\n        runtime: {\n            briefQueue: [],\n            csvUrl: '',\n            pool,\n            lastPoolSyncAt: 0,\n        },\n    };\n}\nfunction readStore() {\n    const variables = getVariables({ type: 'chat' });\n    const raw = _.cloneDeep(_.get(variables, CHAT_STORE_PATH));\n    if (!raw || !_.isPlainObject(raw))\n        return defaultStore();\n    const fallback = defaultStore();\n    const store = {\n        partnerDb: (_.isPlainObject(raw.partnerDb) ? raw.partnerDb : fallback.partnerDb),\n        runtime: {\n            briefQueue: Array.isArray(raw.runtime?.briefQueue) ? raw.runtime.briefQueue.map(String) : [],\n            csvUrl: typeof raw.runtime?.csvUrl === 'string' ? raw.runtime.csvUrl : '',\n            pool: (_.isPlainObject(raw.runtime?.pool) ? raw.runtime.pool : fallback.runtime.pool),\n            lastPoolSyncAt: Number(raw.runtime?.lastPoolSyncAt ?? 0),\n        },\n    };\n    return store;\n}\nfunction sanitizeStoreValues(store) {\n    for (const partner of Object.values(store.partnerDb)) {\n        partner.Meta.Grade = normalizeGrade(partner.Meta.Grade, 'D');\n        partner.Meta.Class = normalizeClass(partner.Meta.Class, 'support');\n    }\n    for (const key of Object.keys(store.runtime.pool)) {\n        const item = store.runtime.pool[key];\n        store.runtime.pool[key] = {\n            ...item,\n            Grade: normalizeGrade(item.Grade, 'D'),\n            Class: normalizeClass(item.Class, 'support'),\n        };\n    }\n}\nfunction writeStore(store) {\n    updateVariablesWith(vars => {\n        _.set(vars, CHAT_STORE_PATH, store);\n        return vars;\n    }, { type: 'chat' });\n}\nfunction ensureStore() {\n    const store = readStore();\n    sanitizeStoreValues(store);\n    if (Object.keys(store.partnerDb).length === 0) {\n        const seeded = defaultStore();\n        writeStore(seeded);\n        return seeded;\n    }\n    if (Object.keys(store.runtime.pool).length === 0) {\n        store.runtime.pool = defaultStore().runtime.pool;\n        writeStore(store);\n    }\n    return store;\n}\nfunction partnerIdsInParty(store) {\n    return Object.values(store.partnerDb)\n        .filter(partner => partner.State.InParty && partner.State.Alive)\n        .map(partner => partner.Id)\n        .slice(0, SLOTS.length);\n}\nfunction updateInPartyFlags(store, partyIds) {\n    const partySet = new Set(partyIds);\n    for (const partner of Object.values(store.partnerDb)) {\n        partner.State.InParty = partner.State.Alive && partySet.has(partner.Id);\n        partner.State = clampState(partner.State);\n        partner.UpdatedAt = now();\n    }\n}\nfunction parseStatData(statData) {\n    return MvuSchema.parse(statData);\n}\nfunction toPartySlotData(partner) {\n    return {\n        PartnerId: partner.Id,\n        Name: partner.Meta.Name,\n        Level: partner.State.Level,\n        Grade: partner.Meta.Grade,\n        Class: partner.Meta.Class,\n        Job: partner.Meta.Job,\n        Affinity: partner.State.Affinity,\n        LoveLevel: partner.State.LoveLevel,\n        Fatigue: partner.State.Fatigue,\n        Alive: partner.State.Alive,\n    };\n}\nfunction applyStoreToStatData(store, statData) {\n    const partyIds = partnerIdsInParty(store);\n    for (let index = 0; index < SLOTS.length; index += 1) {\n        const slot = SLOTS[index];\n        const id = partyIds[index] ?? '';\n        statData.User.PartySlots[slot] = id;\n        if (!id || !store.partnerDb[id]) {\n            statData.User.PartySlotData[slot] = '';\n            continue;\n        }\n        statData.User.PartySlotData[slot] = toPartySlotData(store.partnerDb[id]);\n    }\n    statData.User._OwnedPartnerCount = Object.keys(store.partnerDb).length;\n}\nfunction applyStatDataToStore(store, statData) {\n    const requested = SLOTS.map(slot => statData.User.PartySlots[slot]).filter(Boolean);\n    const validIds = _(requested)\n        .uniq()\n        .filter(id => Boolean(store.partnerDb[id] && store.partnerDb[id].State.Alive))\n        .take(SLOTS.length)\n        .value();\n    updateInPartyFlags(store, validIds);\n    for (const slot of SLOTS) {\n        const id = statData.User.PartySlots[slot];\n        if (!id || !store.partnerDb[id])\n            continue;\n        const slotData = statData.User.PartySlotData[slot];\n        if (slotData === '')\n            continue;\n        store.partnerDb[id].State = clampState({\n            Level: slotData.Level,\n            Affinity: slotData.Affinity,\n            LoveLevel: slotData.LoveLevel,\n            Fatigue: slotData.Fatigue,\n            Alive: slotData.Alive,\n            InParty: true,\n        });\n        store.partnerDb[id].Meta.Name = slotData.Name.trim() || store.partnerDb[id].Meta.Name;\n        store.partnerDb[id].Meta.Grade = normalizeGrade(slotData.Grade, store.partnerDb[id].Meta.Grade);\n        store.partnerDb[id].Meta.Class = normalizeClass(slotData.Class, store.partnerDb[id].Meta.Class);\n        store.partnerDb[id].Meta.Job = slotData.Job.trim() || store.partnerDb[id].Meta.Job;\n        store.partnerDb[id].UpdatedAt = now();\n    }\n}\nasync function syncMessageStatDataFromStore(store) {\n    await waitGlobalInitialized('Mvu');\n    const mvuData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n    const statData = parseStatData(mvuData.stat_data);\n    applyStoreToStatData(store, statData);\n    mvuData.stat_data = statData;\n    await Mvu.replaceMvuData(mvuData, { type: 'message', message_id: 'latest' });\n}\nfunction enqueueBriefProfiles(ids) {\n    if (ids.length === 0)\n        return;\n    const store = ensureStore();\n    const queue = new Set(store.runtime.briefQueue);\n    for (const id of ids) {\n        const normalized = normalizePartnerId(id);\n        const partner = store.partnerDb[normalized];\n        if (!partner)\n            continue;\n        if (partner.State.InParty || !partner.State.Alive)\n            continue;\n        queue.add(normalized);\n    }\n    store.runtime.briefQueue = Array.from(queue);\n    writeStore(store);\n}\nfunction consumeBriefQueue(store) {\n    const queue = [...store.runtime.briefQueue];\n    store.runtime.briefQueue = [];\n    return queue;\n}\nfunction injectProfileTokens(tokens) {\n    if (tokens.length === 0)\n        return;\n    injectPrompts(tokens.map((token, index) => ({\n        id: `sdh_profile_${now()}_${index}`,\n        position: 'none',\n        depth: 0,\n        role: 'system',\n        content: token,\n        should_scan: true,\n    })), { once: true });\n}\nfunction buildProfileTokens(store, briefIds) {\n    const detailTokens = partnerIdsInParty(store)\n        .map(id => store.partnerDb[id]?.ProfileKeys.DetailKey)\n        .filter((value) => typeof value === 'string' && value.trim() !== '');\n    const briefTokens = briefIds\n        .map(id => store.partnerDb[id])\n        .filter((partner) => Boolean(partner))\n        .filter(partner => !partner.State.InParty && partner.State.Alive)\n        .map(partner => partner.ProfileKeys.BriefKey)\n        .filter(token => token.trim() !== '');\n    return _.uniq([...detailTokens, ...briefTokens]);\n}\nfunction findMentionedOwnedPartners(message, store) {\n    const normalizedMessage = message.toLowerCase();\n    const hits = [];\n    for (const partner of Object.values(store.partnerDb)) {\n        if (partner.State.InParty || !partner.State.Alive)\n            continue;\n        const candidates = [partner.Id, partner.Meta.Name].map(value => value.toLowerCase()).filter(value => value.length > 0);\n        if (candidates.some(candidate => normalizedMessage.includes(candidate))) {\n            hits.push(partner.Id);\n        }\n    }\n    return _.uniq(hits);\n}\nasync function readSdp() {\n    await waitGlobalInitialized('Mvu');\n    const mvuData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n    const statData = parseStatData(mvuData.stat_data);\n    return Math.max(0, Math.trunc(statData.User.SDP));\n}\nasync function grantSdp(amount) {\n    const delta = Math.trunc(amount);\n    await waitGlobalInitialized('Mvu');\n    const mvuData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n    const statData = parseStatData(mvuData.stat_data);\n    statData.User.SDP = Math.max(0, Math.trunc(statData.User.SDP + delta));\n    mvuData.stat_data = statData;\n    await Mvu.replaceMvuData(mvuData, { type: 'message', message_id: 'latest' });\n    return statData.User.SDP;\n}\nasync function spendSdp(cost) {\n    const current = await readSdp();\n    if (current < cost)\n        return false;\n    await grantSdp(-cost);\n    return true;\n}\nfunction pickByWeight(table) {\n    const total = table.reduce((sum, item) => sum + Math.max(0, item.weight), 0);\n    if (total <= 0)\n        return 'D';\n    let roll = Math.random() * total;\n    for (const item of table) {\n        roll -= Math.max(0, item.weight);\n        if (roll <= 0)\n            return item.grade;\n    }\n    return table[table.length - 1]?.grade ?? 'D';\n}\nfunction randomChoice(list) {\n    const index = Math.floor(Math.random() * list.length);\n    return list[index];\n}\nfunction findPoolByName(pool, name) {\n    const target = normalizeName(name);\n    return Object.values(pool).find(item => normalizeName(item.Name) === target) ?? null;\n}\nfunction parseCsvLine(line) {\n    const result = [];\n    let value = '';\n    let inQuotes = false;\n    for (let i = 0; i < line.length; i += 1) {\n        const ch = line[i];\n        if (ch === '\"') {\n            if (inQuotes && line[i + 1] === '\"') {\n                value += '\"';\n                i += 1;\n            }\n            else {\n                inQuotes = !inQuotes;\n            }\n            continue;\n        }\n        if (ch === ',' && !inQuotes) {\n            result.push(value);\n            value = '';\n            continue;\n        }\n        value += ch;\n    }\n    result.push(value);\n    return result.map(cell => cell.trim());\n}\nfunction resolveHeaderIndex(headers, aliases) {\n    const lowered = headers.map(h => h.trim().toLowerCase());\n    for (const alias of aliases) {\n        const idx = lowered.indexOf(alias.toLowerCase());\n        if (idx >= 0)\n            return idx;\n    }\n    return -1;\n}\nfunction parsePoolCsv(csvText) {\n    const lines = csvText\n        .split(/\\r?\\n/)\n        .map(line => line.trim())\n        .filter(line => line !== '');\n    if (lines.length < 2)\n        return {};\n    const headers = parseCsvLine(lines[0]);\n    const idIdx = resolveHeaderIndex(headers, ['id', 'partner_id', '파트너id', '파트너 id']);\n    const nameIdx = resolveHeaderIndex(headers, ['name', 'partner_name', '이름', '파트너명', 'partner']);\n    const gradeIdx = resolveHeaderIndex(headers, ['grade', '등급']);\n    const classIdx = resolveHeaderIndex(headers, ['class', 'clazz', '클래스']);\n    const jobIdx = resolveHeaderIndex(headers, ['job', '직업']);\n    const briefIdx = resolveHeaderIndex(headers, ['brief_key', 'brief', '간단키', '간단프로필키']);\n    const detailIdx = resolveHeaderIndex(headers, ['detail_key', 'detail', '상세키', '상세프로필키']);\n    const pool = {};\n    for (let i = 1; i < lines.length; i += 1) {\n        const row = parseCsvLine(lines[i]);\n        const rawName = nameIdx >= 0 ? row[nameIdx] ?? '' : '';\n        if (rawName.trim() === '')\n            continue;\n        const rawId = idIdx >= 0 ? row[idIdx] ?? rawName : rawName;\n        const item = makePoolPartner({\n            id: rawId,\n            name: rawName,\n            grade: gradeIdx >= 0 ? row[gradeIdx] : 'D',\n            clazz: classIdx >= 0 ? row[classIdx] : 'support',\n            job: jobIdx >= 0 ? row[jobIdx] : '미정',\n            briefKey: briefIdx >= 0 ? row[briefIdx] : undefined,\n            detailKey: detailIdx >= 0 ? row[detailIdx] : undefined,\n        });\n        pool[item.Id] = item;\n    }\n    return pool;\n}\nfunction isDuplicateOwned(store, partner) {\n    if (store.partnerDb[partner.Id])\n        return true;\n    const targetName = normalizeName(partner.Name);\n    return Object.values(store.partnerDb).some(item => normalizeName(item.Meta.Name) === targetName);\n}\nasync function registerPartnerFromPool(partner) {\n    const store = ensureStore();\n    if (isDuplicateOwned(store, partner)) {\n        const refund = Math.trunc(COST_NORMAL / 2);\n        return {\n            ok: true,\n            code: 'ok',\n            message: `${partner.Name} 중복 소환: SDP 50% 환급`,\n            spent: 0,\n            refund,\n            partnerId: partner.Id,\n            partnerName: partner.Name,\n            isDuplicate: true,\n        };\n    }\n    const record = makePartnerRecord({\n        Id: partner.Id,\n        Name: partner.Name,\n        Grade: partner.Grade,\n        Class: partner.Class,\n        Job: partner.Job,\n        BriefKey: partner.BriefKey,\n        DetailKey: partner.DetailKey,\n    });\n    store.partnerDb[record.Id] = record;\n    store.runtime.briefQueue = _.uniq([...store.runtime.briefQueue, record.Id]);\n    writeStore(store);\n    await syncMessageStatDataFromStore(store);\n    return {\n        ok: true,\n        code: 'ok',\n        message: `${record.Meta.Name} 소환 성공`,\n        spent: 0,\n        refund: 0,\n        partnerId: record.Id,\n        partnerName: record.Meta.Name,\n        isDuplicate: false,\n    };\n}\nasync function addPartnerToParty(partnerId, preferredSlot) {\n    const id = normalizePartnerId(partnerId);\n    const store = ensureStore();\n    const partner = store.partnerDb[id];\n    if (!partner) {\n        toastr.error(`등록되지 않은 파트너 ID: ${id}`);\n        return false;\n    }\n    if (!partner.State.Alive) {\n        toastr.error(`${partner.Meta.Name}은(는) 생존 상태가 아니어서 편성할 수 없습니다.`);\n        return false;\n    }\n    const currentIds = partnerIdsInParty(store);\n    const slotMap = { Slot1: '', Slot2: '', Slot3: '' };\n    for (let index = 0; index < SLOTS.length; index += 1) {\n        const slot = SLOTS[index];\n        slotMap[slot] = currentIds[index] ?? '';\n    }\n    if (preferredSlot) {\n        for (const slot of SLOTS) {\n            if (slotMap[slot] === id)\n                slotMap[slot] = '';\n        }\n        slotMap[preferredSlot] = id;\n    }\n    else if (!Object.values(slotMap).includes(id)) {\n        const emptySlot = SLOTS.find(slot => slotMap[slot] === '');\n        if (!emptySlot) {\n            toastr.warning('파티 슬롯이 가득 찼습니다. 슬롯 지정 편성을 사용하세요.');\n            return false;\n        }\n        slotMap[emptySlot] = id;\n    }\n    const nextPartyIds = SLOTS.map(slot => slotMap[slot]).filter(value => value !== '');\n    updateInPartyFlags(store, nextPartyIds);\n    writeStore(store);\n    await syncMessageStatDataFromStore(store);\n    return true;\n}\nasync function removePartnerFromParty(partnerIdOrSlot) {\n    const store = ensureStore();\n    const token = partnerIdOrSlot.trim();\n    let targetId = '';\n    if (SLOTS.includes(token)) {\n        const slot = token;\n        const bySlot = partnerIdsInParty(store);\n        targetId = bySlot[SLOTS.indexOf(slot)] ?? '';\n    }\n    else {\n        targetId = normalizePartnerId(token);\n    }\n    if (!targetId || !store.partnerDb[targetId] || !store.partnerDb[targetId].State.InParty)\n        return false;\n    store.partnerDb[targetId].State.InParty = false;\n    store.partnerDb[targetId].UpdatedAt = now();\n    updateInPartyFlags(store, partnerIdsInParty(store).filter(id => id !== targetId));\n    writeStore(store);\n    await syncMessageStatDataFromStore(store);\n    return true;\n}\nasync function applyGachaCostWithDuplicateRefund(cost, result, duplicate) {\n    result.spent = cost;\n    if (!duplicate)\n        return result;\n    const refund = Math.trunc(cost / 2);\n    await grantSdp(refund);\n    result.refund = refund;\n    result.message = `${result.partnerName ?? ''} 중복 소환: SDP ${refund} 환급`;\n    return result;\n}\nasync function drawGacha(drawType) {\n    const cost = drawType === 'normal' ? COST_NORMAL : COST_ADVANCED;\n    const enough = await spendSdp(cost);\n    if (!enough) {\n        return { ok: false, code: 'insufficient_sdp', message: 'SDP가 부족합니다.', spent: 0, refund: 0 };\n    }\n    const store = ensureStore();\n    const pool = Object.values(store.runtime.pool);\n    if (pool.length === 0) {\n        await grantSdp(cost);\n        return { ok: false, code: 'empty_pool', message: '가챠 풀이 비어 있습니다.', spent: 0, refund: 0 };\n    }\n    const table = drawType === 'normal' ? RATE_NORMAL : RATE_ADVANCED;\n    const rolledGrade = pickByWeight(table).toUpperCase();\n    const gradeCandidates = pool.filter(item => item.Grade.trim().toUpperCase() === rolledGrade);\n    const candidates = gradeCandidates.length > 0 ? gradeCandidates : pool;\n    const picked = randomChoice(candidates);\n    const base = await registerPartnerFromPool(picked);\n    base.partnerId = picked.Id;\n    base.partnerName = picked.Name;\n    base.isDuplicate = Boolean(base.isDuplicate);\n    return applyGachaCostWithDuplicateRefund(cost, base, Boolean(base.isDuplicate));\n}\nasync function pickupByName(name) {\n    const trimmed = name.trim();\n    if (trimmed === '') {\n        return { ok: false, code: 'pickup_not_found', message: '이름을 입력하세요.', spent: 0, refund: 0 };\n    }\n    const enough = await spendSdp(COST_PICKUP);\n    if (!enough) {\n        return { ok: false, code: 'insufficient_sdp', message: 'SDP가 부족합니다.', spent: 0, refund: 0 };\n    }\n    const store = ensureStore();\n    const target = findPoolByName(store.runtime.pool, trimmed);\n    if (!target) {\n        await grantSdp(COST_PICKUP);\n        return {\n            ok: false,\n            code: 'pickup_not_found',\n            message: '가챠 풀에 없는 이름입니다. 다시 입력하세요.',\n            spent: 0,\n            refund: 0,\n        };\n    }\n    const base = await registerPartnerFromPool(target);\n    base.partnerId = target.Id;\n    base.partnerName = target.Name;\n    base.isDuplicate = Boolean(base.isDuplicate);\n    return applyGachaCostWithDuplicateRefund(COST_PICKUP, base, Boolean(base.isDuplicate));\n}\nasync function registerCustomPartner(input) {\n    const id = normalizePartnerId(input.Id || input.Name);\n    if (!id || !input.Name.trim()) {\n        return { ok: false, code: 'custom_id_exists', message: '이름/ID를 확인하세요.', spent: 0, refund: 0 };\n    }\n    const normalizedGrade = tryNormalizeGrade(input.Grade);\n    if (!normalizedGrade) {\n        return {\n            ok: false,\n            code: 'invalid_grade',\n            message: 'Invalid Grade. Use one of: EX, S, A, B, C, D.',\n            spent: 0,\n            refund: 0,\n        };\n    }\n    const normalizedClass = tryNormalizeClass(input.Class);\n    if (!normalizedClass) {\n        return {\n            ok: false,\n            code: 'invalid_class',\n            message: 'Invalid Class. Use one of: tank, dps, heal, support, allRound.',\n            spent: 0,\n            refund: 0,\n        };\n    }\n    const store = ensureStore();\n    const targetName = normalizeName(input.Name);\n    const inPoolByName = Object.values(store.runtime.pool).some(item => normalizeName(item.Name) === targetName);\n    if (inPoolByName) {\n        toastr.warning('이미 소환풀 목록에 있는 파트너입니다.');\n        return {\n            ok: false,\n            code: 'custom_name_exists_in_pool',\n            message: '이미 소환풀 목록에 있는 파트너입니다.',\n            spent: 0,\n            refund: 0,\n        };\n    }\n    if (store.partnerDb[id]) {\n        return {\n            ok: false,\n            code: 'custom_id_exists',\n            message: '이미 존재하는 파트너 ID입니다.',\n            spent: 0,\n            refund: 0,\n        };\n    }\n    const enough = await spendSdp(COST_CUSTOM);\n    if (!enough) {\n        return { ok: false, code: 'insufficient_sdp', message: 'SDP가 부족합니다.', spent: 0, refund: 0 };\n    }\n    const record = makePartnerRecord({\n        Id: id,\n        Name: input.Name,\n        Grade: normalizedGrade,\n        Class: normalizedClass,\n        Job: input.Job,\n        Level: input.Level,\n        Affinity: input.Affinity,\n        LoveLevel: input.LoveLevel,\n        BriefKey: input.BriefKey,\n        DetailKey: input.DetailKey,\n    });\n    store.partnerDb[record.Id] = record;\n    store.runtime.briefQueue = _.uniq([...store.runtime.briefQueue, record.Id]);\n    writeStore(store);\n    await syncMessageStatDataFromStore(store);\n    return {\n        ok: true,\n        code: 'ok',\n        message: `${record.Meta.Name} 커스텀 등록 완료`,\n        spent: COST_CUSTOM,\n        refund: 0,\n        partnerId: record.Id,\n        partnerName: record.Meta.Name,\n        isDuplicate: false,\n    };\n}\nasync function setPoolCsvUrl(url) {\n    const store = ensureStore();\n    store.runtime.csvUrl = url.trim();\n    writeStore(store);\n}\nasync function refreshPoolFromCsv() {\n    const store = ensureStore();\n    const url = store.runtime.csvUrl.trim();\n    if (url === '')\n        return { ok: false, message: 'CSV URL이 비어 있습니다.', count: 0 };\n    try {\n        const response = await fetch(url);\n        if (!response.ok) {\n            return { ok: false, message: `CSV 다운로드 실패 (${response.status})`, count: 0 };\n        }\n        const text = await response.text();\n        const parsed = parsePoolCsv(text);\n        if (Object.keys(parsed).length === 0) {\n            return { ok: false, message: 'CSV 파싱 결과가 비어 있습니다.', count: 0 };\n        }\n        store.runtime.pool = parsed;\n        store.runtime.lastPoolSyncAt = now();\n        writeStore(store);\n        return { ok: true, message: `가챠 풀 ${Object.keys(parsed).length}명 로드 완료`, count: Object.keys(parsed).length };\n    }\n    catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        return { ok: false, message: `CSV 로드 오류: ${message}`, count: 0 };\n    }\n}\nasync function getSnapshot() {\n    const store = ensureStore();\n    await waitGlobalInitialized('Mvu');\n    const mvuData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n    const statData = parseStatData(mvuData.stat_data);\n    const sdp = Math.max(0, Math.trunc(statData.User.SDP));\n    const partySlots = { Slot1: '', Slot2: '', Slot3: '' };\n    for (let index = 0; index < SLOTS.length; index += 1) {\n        const slot = SLOTS[index];\n        partySlots[slot] = statData.User.PartySlots[slot] ?? '';\n    }\n    const ownedPartners = Object.values(store.partnerDb)\n        .map(partner => ({\n        Id: partner.Id,\n        Name: partner.Meta.Name,\n        Grade: partner.Meta.Grade,\n        Class: partner.Meta.Class,\n        Job: partner.Meta.Job,\n        InParty: partner.State.InParty,\n        Alive: partner.State.Alive,\n        Level: partner.State.Level,\n    }))\n        .sort((a, b) => a.Name.localeCompare(b.Name));\n    return {\n        sdp,\n        ownedCount: ownedPartners.length,\n        inPartyCount: ownedPartners.filter(item => item.InParty).length,\n        poolCount: Object.keys(store.runtime.pool).length,\n        csvUrl: store.runtime.csvUrl,\n        lastPoolSyncAt: store.runtime.lastPoolSyncAt,\n        partySlots,\n        stat: {\n            User: statData.User,\n            Mission: statData.Mission,\n        },\n        pool: Object.values(store.runtime.pool).sort((a, b) => a.Name.localeCompare(b.Name)),\n        ownedPartners,\n    };\n}\nfunction setupEvents() {\n    eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, variables => {\n        const store = ensureStore();\n        const statData = parseStatData(variables.stat_data);\n        applyStatDataToStore(store, statData);\n        applyStoreToStatData(store, statData);\n        variables.stat_data = statData;\n        writeStore(store);\n    });\n    eventOn(tavern_events.USER_MESSAGE_RENDERED, messageId => {\n        const message = getChatMessages(messageId, { include_swipes: false })[0];\n        if (!message || message.role !== 'user')\n            return;\n        const store = ensureStore();\n        const mentioned = findMentionedOwnedPartners(message.message, store);\n        if (mentioned.length > 0)\n            enqueueBriefProfiles(mentioned);\n    });\n    eventOn(tavern_events.GENERATION_AFTER_COMMANDS, (_type, _option, dryRun) => {\n        if (dryRun)\n            return;\n        const store = ensureStore();\n        const briefIds = consumeBriefQueue(store);\n        const tokens = buildProfileTokens(store, briefIds);\n        if (tokens.length > 0)\n            injectProfileTokens(tokens);\n        writeStore(store);\n    });\n    eventOn(tavern_events.CHAT_CHANGED, () => {\n        void syncMessageStatDataFromStore(ensureStore());\n    });\n}\nfunction exposeApi() {\n    const api = {\n        getSnapshot,\n        setPoolCsvUrl,\n        refreshPoolFromCsv,\n        drawGacha,\n        pickupByName,\n        registerCustomPartner,\n        addPartnerToParty,\n        removePartnerFromParty,\n        grantSdp,\n        queueBriefProfile: (partnerId) => enqueueBriefProfiles([partnerId]),\n        syncNow: async () => {\n            const store = ensureStore();\n            await syncMessageStatDataFromStore(store);\n        },\n    };\n    window.SDH = api;\n    try {\n        window.top.SDH = api;\n    }\n    catch {\n        // top window 접근이 막힌 환경이면 현재 iframe 에만 노출\n    }\n}\n$(async () => {\n    await waitGlobalInitialized('Mvu');\n    const store = ensureStore();\n    await syncMessageStatDataFromStore(store);\n    setupEvents();\n    exposeApi();\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;"],"names":["z","PARTNER_GRADES","normalizePartnerGrade","raw","value","trim","toUpperCase","includes","normalizePartnerClass","lowered","toLowerCase","Schema","object","User","Level","coerce","number","transform","v","Math","max","trunc","Costume","string","SDP","Inventory","record","describe","Description","Quantity","PartySlots","enum","PartySlotData","union","literal","PartnerId","Name","Grade","Class","Job","Affinity","LoveLevel","_","clamp","Fatigue","Alive","boolean","_OwnedPartnerCount","Mission","OnMission","MissionType","MissionGrade","WorldName","WorldSummaryAndObjective","data","slots","dedupedIds","slot","rawId","push","forEach","index","partnerId","slotData","affinity","loveLevel","SLOTS","Vue","COST_PICKUP","RATE_NORMAL","grade","weight","RATE_ADVANCED","tryNormalizeGrade","normalizeGrade","fallback","tryNormalizeClass","normalizeClass","normalizePartnerId","replace","normalizeName","defaultBriefKey","id","defaultDetailKey","now","Date","toSafeInt","num","Number","isFinite","clampState","state","next","InParty","makePartnerRecord","input","Id","Meta","State","ProfileKeys","BriefKey","DetailKey","UpdatedAt","makePoolPartner","name","clazz","job","briefKey","detailKey","defaultStore","luna","rhea","partnerDb","runtime","briefQueue","csvUrl","pool","lastPoolSyncAt","writeStore","store","updateVariablesWith","vars","set","type","ensureStore","variables","getVariables","cloneDeep","get","isPlainObject","Array","isArray","map","String","readStore","partner","Object","values","key","keys","item","sanitizeStoreValues","length","seeded","partnerIdsInParty","filter","slice","updateInPartyFlags","partyIds","partySet","Set","has","parseStatData","statData","parse","toPartySlotData","applyStoreToStatData","async","syncMessageStatDataFromStore","waitGlobalInitialized","mvuData","Mvu","getMvuData","message_id","stat_data","replaceMvuData","enqueueBriefProfiles","ids","queue","normalized","add","from","grantSdp","amount","delta","spendSdp","cost","readSdp","parseCsvLine","line","result","inQuotes","i","ch","cell","resolveHeaderIndex","headers","aliases","h","alias","idx","indexOf","registerPartnerFromPool","targetName","some","isDuplicateOwned","refund","COST_NORMAL","ok","code","message","spent","partnerName","isDuplicate","uniq","addPartnerToParty","preferredSlot","toastr","error","currentIds","slotMap","Slot1","Slot2","Slot3","emptySlot","find","warning","removePartnerFromParty","partnerIdOrSlot","token","targetId","bySlot","applyGachaCostWithDuplicateRefund","duplicate","drawGacha","drawType","rolledGrade","table","total","reduce","sum","roll","random","pickByWeight","gradeCandidates","candidates","picked","list","floor","base","Boolean","pickupByName","trimmed","target","findPoolByName","registerCustomPartner","normalizedGrade","normalizedClass","setPoolCsvUrl","url","refreshPoolFromCsv","count","response","fetch","status","parsed","csvText","lines","split","idIdx","nameIdx","gradeIdx","classIdx","jobIdx","briefIdx","detailIdx","row","rawName","undefined","parsePoolCsv","text","Error","getSnapshot","sdp","partySlots","ownedPartners","sort","a","b","localeCompare","ownedCount","inPartyCount","poolCount","stat","setupEvents","eventOn","events","VARIABLE_UPDATE_ENDED","requested","validIds","take","applyStatDataToStore","tavern_events","USER_MESSAGE_RENDERED","messageId","getChatMessages","include_swipes","role","mentioned","normalizedMessage","hits","candidate","findMentionedOwnedPartners","GENERATION_AFTER_COMMANDS","_type","_option","dryRun","briefIds","consumeBriefQueue","tokens","detailTokens","briefTokens","buildProfileTokens","injectPrompts","position","depth","content","should_scan","once","injectProfileTokens","CHAT_CHANGED","$","api","queueBriefProfile","syncNow","window","SDH","top","exposeApi"],"sourceRoot":""}