{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/StarDustHotel/schema.ts","src://tavern_helper_template/src/StarDustHotel/脚本 스크립트/变量结构 변수 구조/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","const PARTNER_GRADES = ['EX', 'S', 'A', 'B', 'C', 'D'];\nconst PARTNER_CLASSES = ['tank', 'dps', 'heal', 'support', 'allRound'];\nfunction normalizePartnerGrade(raw) {\n    const value = raw.trim().toUpperCase();\n    return PARTNER_GRADES.includes(value)\n        ? value\n        : 'D';\n}\nfunction normalizePartnerClass(raw) {\n    const lowered = raw.trim().toLowerCase();\n    if (lowered === 'tank')\n        return 'tank';\n    if (lowered === 'dps')\n        return 'dps';\n    if (lowered === 'heal' || lowered === 'healer')\n        return 'heal';\n    if (lowered === 'support')\n        return 'support';\n    if (lowered === 'allround' ||\n        lowered === 'all_round' ||\n        lowered === 'all-round' ||\n        lowered === 'allrounder' ||\n        lowered === 'all-rounder') {\n        return 'allRound';\n    }\n    return 'support';\n}\nexport const Schema = z\n    .object({\n    User: z.object({\n        Level: z.coerce.number().transform(v => Math.max(1, Math.trunc(v))),\n        Costume: z.string(),\n        SDP: z.coerce.number().transform(v => Math.max(0, Math.trunc(v))),\n        Inventory: z.record(z.string().describe('Item ID'), z.object({\n            Description: z.string(),\n            Quantity: z.coerce.number().transform(v => Math.max(0, Math.trunc(v))),\n        })),\n        PartySlots: z.record(z.enum(['Slot1', 'Slot2', 'Slot3']), z.string()),\n        PartySlotData: z.record(z.enum(['Slot1', 'Slot2', 'Slot3']), z.union([\n            z.literal(''),\n            z.object({\n                PartnerId: z.string(),\n                Name: z.string(),\n                Level: z.coerce.number().transform(v => Math.max(1, Math.trunc(v))),\n                Grade: z.string().transform(v => normalizePartnerGrade(v)),\n                Class: z.string().transform(v => normalizePartnerClass(v)),\n                Job: z.string(),\n                Affinity: z.coerce.number().transform(v => Math.trunc(v)),\n                LoveLevel: z.coerce.number().transform(v => _.clamp(Math.trunc(v), -5, 5)),\n                Fatigue: z.coerce.number().transform(v => _.clamp(Math.trunc(v), 0, 100)),\n                Alive: z.boolean(),\n            }),\n        ])),\n        _OwnedPartnerCount: z.coerce.number().transform(v => Math.max(0, Math.trunc(v))),\n    }),\n    Mission: z.object({\n        OnMission: z.boolean(),\n        MissionType: z.enum(['normal', 'eros']),\n        MissionGrade: z.enum(['S', 'A', 'B', 'C', 'D']),\n        WorldName: z.string(),\n        WorldSummaryAndObjective: z.string(),\n    }),\n})\n    .transform(data => {\n    const slots = ['Slot1', 'Slot2', 'Slot3'];\n    const dedupedIds = [];\n    for (const slot of slots) {\n        const rawId = data.User.PartySlots[slot].trim();\n        if (rawId === '' || dedupedIds.includes(rawId))\n            continue;\n        dedupedIds.push(rawId);\n    }\n    slots.forEach((slot, index) => {\n        const partnerId = dedupedIds[index] ?? '';\n        data.User.PartySlots[slot] = partnerId;\n        const slotData = data.User.PartySlotData[slot];\n        if (partnerId === '' || slotData === '') {\n            data.User.PartySlotData[slot] = '';\n            return;\n        }\n        let affinity = Math.trunc(slotData.Affinity);\n        let loveLevel = _.clamp(Math.trunc(slotData.LoveLevel), -5, 5);\n        while (affinity >= 100 && loveLevel < 5) {\n            affinity -= 100;\n            loveLevel += 1;\n        }\n        while (affinity <= -100 && loveLevel > -5) {\n            affinity += 100;\n            loveLevel -= 1;\n        }\n        data.User.PartySlotData[slot] = {\n            ...slotData,\n            PartnerId: partnerId,\n            Level: Math.max(1, Math.trunc(slotData.Level)),\n            Grade: normalizePartnerGrade(slotData.Grade),\n            Class: normalizePartnerClass(slotData.Class),\n            Affinity: _.clamp(affinity, -99, 99),\n            LoveLevel: _.clamp(loveLevel, -5, 5),\n            Fatigue: _.clamp(Math.trunc(slotData.Fatigue), 0, 100),\n        };\n    });\n    data.User._OwnedPartnerCount = Math.max(0, Math.trunc(data.User._OwnedPartnerCount));\n    // Mission fallback values.\n    if (!data.Mission.OnMission) {\n        data.Mission.MissionType = 'normal';\n        data.Mission.MissionGrade = 'D';\n        data.Mission.WorldName = '스타더스트 호텔';\n        data.Mission.WorldSummaryAndObjective = '대기중';\n    }\n    else {\n        if (data.Mission.WorldName.trim() === '')\n            data.Mission.WorldName = '스타더스트 호텔';\n        if (data.Mission.WorldSummaryAndObjective.trim() === '')\n            data.Mission.WorldSummaryAndObjective = '임무 진행중';\n    }\n    return data;\n});\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\nimport { Schema } from '../../schema';\n\n$(() => {\n  registerMvuSchema(Schema);\n});\n"],"names":["z","PARTNER_GRADES","normalizePartnerGrade","raw","value","trim","toUpperCase","includes","normalizePartnerClass","lowered","toLowerCase","Schema","object","User","Level","coerce","number","transform","v","Math","max","trunc","Costume","string","SDP","Inventory","record","describe","Description","Quantity","PartySlots","enum","PartySlotData","union","literal","PartnerId","Name","Grade","Class","Job","Affinity","LoveLevel","_","clamp","Fatigue","Alive","boolean","_OwnedPartnerCount","Mission","OnMission","MissionType","MissionGrade","WorldName","WorldSummaryAndObjective","data","slots","dedupedIds","slot","rawId","push","forEach","index","partnerId","slotData","affinity","loveLevel","$"],"sourceRoot":""}